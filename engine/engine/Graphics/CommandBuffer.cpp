#include "engine/pch.h"
#include "CommandBuffer.hpp"

////////////////////////////////////////////////////////////////
//////////////////////////// Define ////////////////////////////
////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////
//////////////////////////// Static ////////////////////////////
////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////
/////////////////////// Standalone Function /////////////////////
////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////
///////////////////////// Member Function //////////////////////
////////////////////////////////////////////////////////////////


void CommandBufferChain::Init( Device& device )
{
   for(CommandBuffer& cb: mCommandBuffers) {
      cb.Init( device );
   }
}

CommandBuffer& CommandBufferChain::GetUsableCommandBuffer( bool forceSearch )
{
   CommandBuffer* buffer = &(mCommandBuffers[0]);

   // the allocator used this frame should be the last updated one(when Window::SwapBuffer)
   for(uint i = 1; i < mCommandBuffers.size(); i++) {
      CommandBuffer& cb = mCommandBuffers[i];
      ASSERT_DIE( cb.mLastUpdateFrame != buffer->mLastUpdateFrame ); // if they are the same... something is terribly wrong
      if(cb.mLastUpdateFrame > buffer->mLastUpdateFrame) {
         buffer = &cb;
      }
   }

   return *buffer;
}

